generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./server/food_waste.db"
}

model Donation {
  id        Int      @id @default(autoincrement())
  item      String
  quantity  String
  location  String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("donations")
}

model User {
  id        Int          @id @default(autoincrement())
  name      String
  email     String       @unique
  passwordHash String    @default("")
  items     FoodItem[]
  groups    FriendGroup[] @relation("GroupOwner")
  claims    Claim[]      @relation("ClaimUser")
  members   GroupMember[]
  messages  GroupMessage[]
  createdAt DateTime     @default(now()) @map("created_at")
}

model FoodCategory {
  id    Int        @id @default(autoincrement())
  name  String     @unique
  items FoodItem[]
  createdAt DateTime @default(now()) @map("created_at")
}

model FoodItem {
  id          Int         @id @default(autoincrement())
  title       String
  status      ItemStatus  @default(IN_FRIDGE)
  expiresAt   DateTime?
  owner       User        @relation(fields: [ownerId], references: [id])
  ownerId     Int
  category    FoodCategory? @relation(fields: [categoryId], references: [id])
  categoryId  Int?
  claims      Claim[]
  shares      GroupShare[]
  createdAt   DateTime    @default(now()) @map("created_at")

  @@unique([id, ownerId])
}

model FriendGroup {
  id        Int           @id @default(autoincrement())
  name      String
  owner     User          @relation("GroupOwner", fields: [ownerId], references: [id])
  ownerId   Int
  members   GroupMember[]
  shares    GroupShare[]
  messages  GroupMessage[]
  createdAt DateTime      @default(now()) @map("created_at")
}

model GroupMember {
  id        Int         @id @default(autoincrement())
  group     FriendGroup @relation(fields: [groupId], references: [id])
  groupId   Int
  user      User        @relation(fields: [userId], references: [id])
  userId    Int
  tag       String?
  createdAt DateTime    @default(now()) @map("created_at")
}

model Claim {
  id         Int        @id @default(autoincrement())
  item       FoodItem   @relation(fields: [itemId], references: [id])
  itemId     Int
  claimer    User       @relation("ClaimUser", fields: [claimerId], references: [id])
  claimerId  Int
  status     ClaimStatus @default(PENDING)
  createdAt  DateTime   @default(now()) @map("created_at")
  decidedAt  DateTime?
}

model GroupShare {
  id        Int         @id @default(autoincrement())
  item      FoodItem    @relation(fields: [itemId], references: [id])
  itemId    Int
  group     FriendGroup @relation(fields: [groupId], references: [id])
  groupId   Int
  createdAt DateTime    @default(now()) @map("created_at")

  @@unique([itemId, groupId])
}

model GroupMessage {
  id        Int         @id @default(autoincrement())
  group     FriendGroup @relation(fields: [groupId], references: [id])
  groupId   Int
  author    User        @relation(fields: [authorId], references: [id])
  authorId  Int
  content   String
  createdAt DateTime    @default(now()) @map("created_at")
}

enum ItemStatus {
  IN_FRIDGE
  AVAILABLE
  CLAIMED
}

enum ClaimStatus {
  PENDING
  ACCEPTED
  REJECTED
}

